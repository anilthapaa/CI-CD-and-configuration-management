name: Integration Test with Service Container

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
      app:
        image: ghcr.io/${{ github.repository_owner }}/weather-app:latest
        ports:
          - 80:80
        options: --health-cmd="curl -f http://localhost:80 || exit 1" --health-interval=10s --health-timeout=5s --health-retries=5

    steps:
      - name: Wait for service to be healthy
        run: |
          for i in {1..10}; do
            curl -f http://localhost:80 && break
            sleep 3
          done

      - name: Test service response
        run: curl -f http://localhost:80